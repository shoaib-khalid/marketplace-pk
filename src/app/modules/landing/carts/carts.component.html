<!-- Voucher List -->
<div class="relative flex flex-col items-center bg-card w-full h-full">
    <!-- Container -->
    <div class="flex flex-col md:flex-row w-full h-full">
        <!-- Carts -->
        <ng-container *ngIf="carts && (carts.length > 0); else noCarts">
            <!-- Delivery Address (xs) -->
            <div class="block md:hidden w-full flex flex-col justify-center items-start border rounded-lg p-2 mb-2">
                <!-- Header -->
                <div class="flex flex-row border-b justify-start items-center pb-2 w-full">
                    <mat-icon 
                        class="icon-size-5 text-primary" 
                        [svgIcon]="'mat_solid:location_on'"></mat-icon>
                    <span class="ml-2 font-bold">Delivery Address</span>
                </div>
                <ng-container *ngIf="customerAddress; else noAddress">
                    <div class="flex flex-row p-2 font-medium gap-1 items-center justify-between w-full">
                        <!-- Address  -->
                        <div class="flex flex-col font-medium gap-1">
                            <span class="">{{customerAddress.name}}</span>
                            <span class="">{{customerAddress.phoneNumber}}</span>
                            <span class="">{{customerAddress.address}}, {{customerAddress.postCode}}, {{customerAddress.city}}, {{customerAddress.state}}</span>
                        </div>
                        <!-- Remove Address -->
                        <div *ngIf="!customerId">
                            <span class="flex justify-center items-center text-center px-1 cursor-pointer">
                                <mat-icon 
                                    (click)="deleteGuestAddress()"
                                    class="icon-size-4" 
                                    [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                            </span>
                        </div>
                    </div>
                    <div class="flex w-full justify-center items-center">
                        <button
                            [routerLink]="['/address']"
                            [queryParams]="{origin: 'carts'}"
                            class="my-2 w-full font-semibold p-1 rounded-md bg-primary"                            >
                            <span class="text-white">Change</span>
                        </button>
                    </div>
                </ng-container>
                <ng-template #noAddress>
                    <!-- Enter Address -->
                    <span class="flex mt-2 text-center">Add your delivery address</span>
                    <!-- Button -->
                    <div class="flex w-full justify-center items-center mt-2">
                        <button 
                            [routerLink]="'/address'"
                            [queryParams]="{origin: 'carts'}"
                            class="my-2 w-full bg-primary-500 hover:bg-primary-600 rounded-md flex flex-row items-center justify-center p-1"
                        >
                            <mat-icon 
                                class="icon-size-5 text-white" 
                                [svgIcon]="'heroicons_solid:plus'"></mat-icon>
                            <span class="ml-1 font-semibold text-white">Add</span>
                        </button>
                    </div>
                </ng-template>
            </div>
            <!-- Store pickup info (MOBILE)  -->
            <ng-container *ngIf="hasSelfPickup">
                <div class="block md:hidden w-full flex flex-col justify-center items-start border rounded-lg p-2 mb-2">
                    <!-- Header -->
                    <div class="flex flex-row border-b justify-start items-center pb-2 w-full">
                        <mat-icon 
                            class="icon-size-5 text-primary" 
                            [svgIcon]="'mat_solid:contact_phone'"></mat-icon>
                        <span class="ml-2 font-bold">Contact Info for Self Pick-up</span>
                    </div>
                    <ng-container *ngIf="selfPickupInfo; else noSelfPickupInfo">
                        <div class="w-full flex flex-col rounded">
                            <div class="flex flex-row p-2 font-medium gap-1 items-center justify-between w-full">
                                <!-- Address  -->
                                <div class="flex flex-col font-medium gap-1">
                                    <span class="">{{selfPickupInfo.name}}</span>
                                    <span class="">{{selfPickupInfo.phoneNumber}}</span>
                                    <span class="">{{selfPickupInfo.email}}</span>
                                </div>
                            </div>
                            <!-- Button -->
                            <div class="flex w-full justify-center items-center">
                                <button 
                                    (click)="addRequiredInfo(0, true)"
                                    class="my-2 w-full bg-primary-500 hover:bg-primary-600 rounded-md flex flex-row items-center justify-center p-1"
                                >
                                    <mat-icon 
                                        class="icon-size-4 text-white" 
                                        [svgIcon]="'heroicons_solid:pencil'"></mat-icon>
                                    <span class="ml-1 font-semibold text-white">Edit</span>
                                </button>
                            </div>
                        </div>
                    </ng-container>
                    <ng-template #noSelfPickupInfo>
                        <!-- Enter contact info -->
                        <span class="flex mt-2 text-center">Add your contact info</span>
                        <!-- Button -->
                        <div class="flex w-full justify-center items-center mt-2">
                            <button 
                            (click)="addRequiredInfo()"
                                class="my-2 w-full bg-primary-500 hover:bg-primary-600 rounded-md flex flex-row items-center justify-center p-1"
                            >
                                <mat-icon 
                                    class="icon-size-5 text-white" 
                                    [svgIcon]="'heroicons_solid:plus'"></mat-icon>
                                <span class="ml-1 font-semibold text-white">Add</span>
                            </button>
                        </div>
                    </ng-template>
                </div>
            </ng-container>

            <!-- Carts Details -->
            <div class="flex flex-col w-full items-center">
                <div class="grid w-full">
                    <!-- Title -->
                    <span class="text-lg sm:text-3xl font-semibold mb-2">Your Cart</span>

                    <!-- Checkbox all carts MOBILE -->
                    <div class="lg:hidden cart-title-grid grid w-full pb-2 px-2 border border-white">
                        <!-- Checkbox all in cart -->
                        <div class="flex items-start justify-center items-center w-full">
                            <input type="checkbox" [disabled]="selectedCart.disabled" [(ngModel)]="selectedCart.selected" (change)="selectCart(carts,null,null,$event.target.checked)"/>
                        </div>
                        <div class="flex flex-col justify-start ml-2">
                            <span class="font-medium text-base tracking-tight">Product</span>
                        </div>
                    </div>

                    <!-- Header -->
                    <div class="hidden lg:grid cart-grid w-full sticky py-2 border-b border-gray-600 tracking-tight">
                        <!-- Checkbox all carts DESKTOP-->
                        <div class="flex items-center justify-center w-full">
                            <input type="checkbox" [disabled]="selectedCart.disabled" [(ngModel)]="selectedCart.selected" (change)="selectCart(carts,null,null,$event.target.checked)"/>
                        </div>
                        <span class="font-semibold text-left ml-4">Product</span>
                        <span class="font-semibold text-center">Unit Price</span>
                        <span class="font-semibold text-center">Quantity</span>
                        <span class="font-semibold text-center">Total Price</span>
                        <span></span>
                    </div>
                    <ng-container *ngFor="let cart of carts; let i = index">
                        <div class="relative w-full border lg:border-0 lg:border-b lg:last:border-b-0 lg:border-gray-600 rounded-lg lg:rounded-none pb-2 last:pb-0 mb-2 lg:mb-0">
                            <!-- Store timing bg-gradient-to-b from-black -->
                            <!-- <div *ngIf="isStoreClose(cart.storeId)" 
                                class="absolute bg-black bg-opacity-60 z-10 w-full h-full flex flex-col items-center justify-center rounded-lg lg:rounded gap-2">
                                <div class="flex flex-col rounded-lg bg-primary text-white items-center p-3 leading-none uppercase">
                                    <span class="text-white text-2xl font-medium">{{storesOpening[i].messageTitle}}</span>
                                    <span class="text-white text-5xl font-semibold">CLOSED</span>
                                </div>
                                <span class="w-3/4 text-center text-white text-md lg:text-lg font-medium tracking-tight">{{storesOpening[i].message}}</span>
                            </div> -->
                            <div class="px-2 lg:px-0">
                                <!-- Store timing MOBILE -->
                                <div *ngIf="isStoreClose(cart.storeId)" 
                                    class="lg:hidden px-1 flex flex-row justify-end items-center border-b h-14 lg:h-16 w-full">
                                    <div class="flex flex-row max-w-1/2 gap-x-1">
                                        <div class="flex flex-col rounded-md bg-red-500 text-white items-center p-2 leading-none uppercase">
                                            <span class="text-white text-xs font-medium tracking-tight">{{storesOpening[i].messageTitle}}</span>
                                            <span class="text-white text-xl font-semibold tracking-tighter">CLOSED</span>
                                        </div>
                                        <div class="flex items-center ml-1">
                                            <span class="text-black text-xs lg:text-sm font-medium tracking-tight leading-snug">{{storesOpening[i].message}}</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Cart Header -->
                                <div class="cart-title-grid grid w-full sticky border-b h-14 lg:h-16 items-center">
                                    <!-- Checkbox all in cart -->
                                    <div class="flex items-start justify-center items-center w-full">
                                        <input 
                                        [disabled]="selectedCart.carts[i + pagination.startIndex].disabled" [(ngModel)]="selectedCart.carts[i + pagination.startIndex].selected" type="checkbox" (change)="selectCart(null,cart,null,$event.target.checked)">
                                    </div>
                                    <div class="flex flex-col justify-start ml-2 md:ml-4">
                                        <div class="flex flex-row justify-between items-center">
                                            <span (click)="redirect('store', cart.store, null)" class="text-md sm:text-xl font-semibold hover:cursor-pointer">{{cart.store.name}}</span>
                                            
                                            <div class="flex flex-row items-center gap-2">
                                                <!-- Store timing DESKTOP -->
                                                <div *ngIf="isStoreClose(cart.storeId)" 
                                                    class="hidden lg:flex flex-row items-center justify-center gap-2">
                                                    <div class="flex flex-col rounded-md bg-red-500 text-white items-center p-2 leading-none uppercase">
                                                        <span class="text-white text-[8px] lg:text-xs font-medium tracking-tight">{{storesOpening[i].messageTitle}}</span>
                                                        <span class="text-white text-[10px] lg:text-xl font-semibold tracking-tighter">CLOSED</span>
                                                    </div>
                                                    <span class="text-black text-xs lg:text-sm font-medium tracking-tight max-w-[120px]">{{storesOpening[i].message}}</span>
                                                </div>
                                                <!-- Required Info  -->
                                                <div *ngIf="selectedCart.carts[i + pagination.startIndex].showRequiredInfo && !selectedCart.carts[i + pagination.startIndex].disabled"
                                                    class="flex flex-col justify-center items-center text-center mr-3">
                                                    <span class="flex tracking-tight justify-center items-center text-sm">Required Info
                                                    </span>
                                                    <mat-icon 
                                                        *ngIf="validateCustomerInfo(i + pagination.startIndex)"
                                                        class="icon-size-6 text-primary cursor-pointer" 
                                                        (click)="addRequiredInfo(i + pagination.startIndex)"
                                                        [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                                                    <mat-icon 
                                                        *ngIf="!validateCustomerInfo(i + pagination.startIndex)"
                                                        class="icon-size-6 text-red-500 cursor-pointer" 
                                                        (click)="addRequiredInfo(null)"
                                                        [svgIcon]="'heroicons_outline:exclamation-circle'"></mat-icon>
                                                </div>
                                                <!-- Remove Cart -->
                                                <div class="flex w-[24px] md:w-[20px] xl:w-[30px] justify-center">
                                                    <span class="flex justify-center items-center text-center px-1 cursor-pointer">
                                                        <mat-icon 
                                                            [matTooltip]="'Delete cart'"
                                                            (click)="deleteCart(cart.id)"
                                                            class="icon-size-4" 
                                                            [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- <span class="text-sm sm:text-sm text-secondary">Cart ID: {{cart.id}}</span> -->
                                        <!-- <span class="text-sm sm:text-sm text-secondary">Last Updated: {{cart.updated | date:'MMM dd, h:mm a'}}</span> -->
                                    </div>
                                </div>
                                <!-- Cart Items -->
                                <ng-container *ngIf="cart.cartItems && cart.cartItems.length; else noCartItem">
                                    <ng-container *ngFor="let cartItem of cart.cartItems; let j = index">
                                        <div class="w-full sticky mt-4" [ngClass]="currentScreenSize.includes('lg') ?  'cart-grid grid' : 'flex flex-row justify-between'">
                                            <!-- Checkbox each item -->
                                            <div class="flex flex-none items-center lg:justify-center mt-2 w-auto lg:w-full px-1 lg:px-0">
                                                <input
                                                [disabled]="selectedCart.carts[i + pagination.startIndex].cartItem[j].disabled" [(ngModel)]="selectedCart.carts[i + pagination.startIndex].cartItem[j].selected" type="checkbox" (change)="selectCart(null,cart,cartItem,$event.target.checked)">
                                            </div>
                                            <!-- Image, Title, Variants -->
                                            <div class="flex flex-row grow items-center justify-start ml-3 md:ml-4">
                                                <img class="w-14 max-w-14 max-h-14 min-h-14 sm:w-18 sm:max-w-18 sm:h-18 sm:max-h-18 shadow rounded" [src]="cartItem.productAsset ? cartItem.productAsset.url : cartItem.productInventory.product.thumbnailUrl ? cartItem.productInventory.product.thumbnailUrl : displayStoreLogo(cart.store)">
                                                <div class="flex flex-col ml-2 items-start justify-start sm:justify-center gap-1">
                                                    <span (click)="redirect('product', cart.store, cartItem.productInventory.product.seoName)" class="text-md sm:text-md font-semibold line-clamp-2 hover:cursor-pointer">{{cartItem.productName}}</span>
                                                    <div class="flex flex-row items-center">
                                                        <!-- Display variants -->
                                                        <ng-container *ngIf="cartItem.productInventory.productInventoryItems.length > 0">
                                                            <ng-container *ngFor="let variant of cartItem.productInventory.productInventoryItems">
                                                                <span class="leading-tight text-xs lg:text-sm text-secondary flex flex-wrap">{{variant.productVariantAvailable.productVariant.name}}: {{variant.productVariantAvailable.value}}</span>
                                                                <span class="block last:hidden leading-tight text-xs lg:text-sm text-secondary">,&nbsp;</span>
                                                            </ng-container>
                                                        </ng-container>
                                                        <!-- Display Combo -->
                                                        <ng-container *ngIf="cartItem.cartSubItem.length > 0">
                                                            <ng-container  *ngFor="let combo of cartItem.cartSubItem">
                                                                <span class="leading-tight text-xs lg:text-sm text-secondary flex flex-wrap">{{combo.productName}}</span>
                                                                <span class="block last:hidden leading-tight text-xs lg:text-sm text-secondary">,&nbsp;</span>
                                                            </ng-container>
                                                        </ng-container>
                                                    </div>
                                                    <!-- Display Special Instruction -->
                                                    <div *ngIf="cartItem.specialInstruction" class="flex flex-row items-center">
                                                        <span class="leading-tight text-xs md:text-sm text-secondary flex flex-wrap">Instruction: {{cartItem.specialInstruction}}</span>
                                                        <!-- <span class="leading-tight text-xs text-secondary flex flex-wrap">{{cartItem.specialInstruction}}</span> -->
                                                    </div>
                                                    <!-- Quantity -->
                                                    <div class="block md:hidden flex flex-col justify-center items-center mt-0.5">
                                                        <div class="flex flex-row h-6 w-16 justify-center items-center rounded-md relative border border-primary">
                                                            <button (click)="checkQuantity(cart.id,cartItem,null,'decrement')" class="text-black hover:bg-primary h-full w-20 rounded-l-md cursor-pointer outline-none">
                                                                <span class="flex justify-center text-sm">−</span>
                                                            </button>
                                                                <input 
                                                                    matInput
                                                                    (change)="checkQuantity(cart.id,cartItem,$event.target.value)" 
                                                                    type="number" 
                                                                    class="pt-[0.1rem] focus:outline-none text-center w-full font-semibold text-xs text-black focus:text-black md:text-base cursor-default flex items-center outline-none" 
                                                                    name="custom-input-number-small" 
                                                                    [value]="cartItem.quantity"/>
                                                            <button (click)="checkQuantity(cart.id,cartItem,null,'increment')" class="text-black hover:bg-primary h-full w-20 rounded-r-md cursor-pointer">
                                                                <span class="flex justify-center text-sm">+</span>
                                                            </button>
                                                        </div>
                                                        <ng-container *ngIf="cartItem.productInventory.product.allowOutOfStockPurchases === false">
                                                            <ng-container *ngIf="cartItem.productInventory.quantity <= 10 ">
                                                                <ng-container *ngIf="cartItem.productInventory.quantity > 1">
                                                                    <span class="text-xs text-red-500 sm:mt-0.5">{{cartItem.productInventory.quantity}} items left</span>
                                                                </ng-container>
                                                                <ng-container *ngIf="cartItem.productInventory.quantity <= 1">
                                                                    <span class="text-xs text-red-500 sm:mt-0.5">{{cartItem.productInventory.quantity}} item left</span>
                                                                </ng-container>
                                                            </ng-container>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Unit Price -->
                                            <div class="hidden sm:flex flex-col justify-center items-center text-center px-1">
                                                <span class="text-xs md:text-sm line-through">{{cartItem.normalPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                <span class="font-semibold text-sm md:text-md">{{cartItem.productPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                            </div>
                                            <!-- Quantity -->
                                            <div class="hidden md:flex flex-col justify-center items-center mx-2">
                                                <div class="flex flex-row h-6 w-16 justify-center items-center rounded-md relative border border-primary">
                                                    <button (click)="checkQuantity(cart.id,cartItem,null,'decrement')" class="pb-[0.1rem] text-black hover:bg-primary h-full w-20 rounded-l-md cursor-pointer outline-none">
                                                        <span class="flex justify-center">−</span>
                                                    </button>
                                                        <input
                                                            (change)="checkQuantity(cart.id,cartItem,$event.target.value)" 
                                                            type="number" 
                                                            class="pt-[0.1rem] focus:outline-none text-center w-full font-semibold text-md text-black focus:text-black md:text-basecursor-default flex items-center outline-none" 
                                                            name="custom-input-number" 
                                                            [value]="cartItem.quantity"/>
                                                    <button (click)="checkQuantity(cart.id,cartItem,null,'increment')" class="pb-[0.1rem] text-black hover:bg-primary h-full w-20 rounded-r-md cursor-pointer">
                                                        <span class="flex justify-center">+</span>
                                                    </button>
                                                </div>
                                                <ng-container *ngIf="cartItem.productInventory.product.allowOutOfStockPurchases === false">
                                                    <ng-container *ngIf="cartItem.productInventory.quantity <= 10 ">
                                                        <ng-container *ngIf="cartItem.productInventory.quantity > 1">
                                                            <span class="text-xs text-red-500 sm:mt-0.5">{{cartItem.productInventory.quantity}} items left</span>
                                                        </ng-container>
                                                        <ng-container *ngIf="cartItem.productInventory.quantity <= 1">
                                                            <span class="text-xs text-red-500 sm:mt-0.5">{{cartItem.productInventory.quantity}} item left</span>
                                                        </ng-container>
                                                    </ng-container>
                                                </ng-container>
                                            </div>
                                            <!-- Total Price -->
                                            <span class="hidden sm:flex justify-center items-center font-semibold text-center text-sm md:text-md min-w-20 max-w-auto truncate">{{cartItem.price | currency: cart.store.regionCountry.currencySymbol}}</span>
                                            <!-- Remove Item -->
                                            <span class="hidden sm:flex justify-center items-center text-center px-1 cursor-pointer">
                                                <mat-icon 
                                                    [matTooltip]="'Delete item'"
                                                    (click)="deleteCartItem(cart.id, cartItem)"
                                                    class="icon-size-4" 
                                                    [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                            </span>
                                            <!-- Total Price , Unit Price , Remove button for sm-->
                                            <div class="flex flex-col sm:hidden items-end justify-between">
                                                <!-- Remove Item -->
                                                <span class="flex justify-center items-center text-center px-1 cursor-pointer">
                                                    <mat-icon
                                                        [matTooltip]="'Delete item'"
                                                        (click)="deleteCartItem(cart.id, cartItem)" 
                                                        class="icon-size-4" 
                                                        [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                                </span>
                                                <div class="flex flex-col w-26 justify-end items-end">
                                                    <!-- Unit Price -->
                                                    <div class="flex flex-col justify-center items-end text-center px-1">
                                                        <span class="text-xs md:text-sm line-through">{{cartItem.normalPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                        <span class="text-sm md:text-xs">{{cartItem.quantity}} x {{cartItem.productPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                    </div>
                                                    <!-- Total Price -->
                                                    <span class="flex justify-center items-center font-semibold text-center text-sm md:text-md px-1">{{cartItem.price | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <!-- Additional Info -->
                                    <div class="flex flex-col mt-4">
                                        <span class="text-secondary">Additional Information</span>
                                        <div class="w-full flex flex-row text-center items-center my-2 text-sm"> 
                                            <span class="mr-2">Order Notes (Optional)</span>
                                            <span  *ngIf="selectedCart && selectedCart.carts[i + pagination.startIndex].description.isOpen === false" (click)="open(cart.id)" class="text-primary cursor-pointer">Insert Order Notes</span>
                                            <span *ngIf="selectedCart && selectedCart.carts[i + pagination.startIndex].description.isOpen === true" (click)="close(cart.id)" class="text-primary cursor-pointer">Cancel</span>
                                        </div>
                                        <!-- Additional info -->
                                        <mat-form-field *ngIf="selectedCart && selectedCart.carts[i + pagination.startIndex].description.isOpen === true"
                                        @zoomIn @zoomOut class="w-full mt-2" floatLabel="always">
                                            <textarea
                                                matInput
                                                [(ngModel)] ="selectedCart.carts[i + pagination.startIndex].description.value"
                                                placeholder="Tell us when you prefer this order to be delivered or any special request you may have"
                                                [rows]="full"
                                                maxlength="100"
                                                class="h-5 text-sm"
                                                autocomplete="disabled"
                                                matTextareaAutosize></textarea>
                                        </mat-form-field>
                                    </div>
                                    <!-- Select delivery type  -->
                                    <ng-container *ngIf="true">
                                        <span class="text-sm">Delivery Type</span>
                                        <div class="flex flex-row w-auto justify-between my-2 text-sm">
                                            <mat-radio-group
                                                class="flex flex-row gap-x-2"
                                                [disabled]="isLoading" 
                                                [ngClass]="isLoading ? 'cursor-wait' : ''"
                                                [(ngModel)]="selectedCart.carts[i + pagination.startIndex].isSelfPickup"
                                                [ngModelOptions]="{standalone: true}"
                                                [color]="'primary'"
                                                (change)="selectSelfPickup(cart.id, $event.value)"
                                                >
                                                <mat-radio-button
                                                    class=""
                                                    [value]="false">
                                                    Delivery
                                                </mat-radio-button>
                                                <span>|</span>
                                                <mat-radio-button
                                                    class=""
                                                    [value]="true">
                                                    Self Pick-Up
                                                </mat-radio-button>
                                            </mat-radio-group>
                                            <!-- Total Items  -->
                                            <div *ngIf="selectedCart.carts[i + pagination.startIndex].isSelfPickup === true" class="flex flex-col sm:flex-row items-center sm:min-w-auto gap-1 sm:gap-x-2">
                                                <span class="text-sm">Total Items ({{cart.cartItems ? cart.cartItems.length : 0}}):</span>
                                                <span class="font-semibold text-sm">{{ getCartItemsTotal(cart.cartItems) | currency: cart.store.regionCountry.currencySymbol }}</span>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <span *ngIf="selectedCart.carts[i + pagination.startIndex].isSelfPickup === false" class="text-sm">Delivery Options</span>
                                    <!-- Select Delivery Provider for DESKTOP-->
                                    <ng-container *ngIf="currentScreenSize.includes('lg') && selectedCart.carts[i + pagination.startIndex].isSelfPickup === false">
                                        <div class="flex flex-row justify-between items-center my-2 w-auto">
                                            <!-- Shipping Info  -->
                                            <div class="flex flex-row justify-between items-center w-auto gap-x-4">
                                                <ng-container *ngIf="!selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage && selectedCart.carts[i + pagination.startIndex].deliveryQuotationId; else deliveryErrorDesktop">
                                                    <div class="flex flex-row justify-between items-center w-[200px]">
                                                        <div *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryType !== 'SELF'" class="flex flex-row w-full">
                                                            <mat-form-field class="w-full rounded text-sm fuse-mat-no-subscript fuse-mat-dense">
                                                                <mat-select
                                                                    placeholder="Select a delivery provider"
                                                                    (click)="openProviderSelection()"
                                                                    (selectionChange)="changeDeliveryProvider(deliveryProviderSelector.value, i + pagination.startIndex);"
                                                                    [(ngModel)]="selectedCart.carts[i + pagination.startIndex].deliveryProviderId"
                                                                    [ngModelOptions]="{standalone: true}"
                                                                    #deliveryProviderSelector="matSelect"
                                                                    >
                                                                    <mat-select-trigger>
                                                                        <span class="flex items-center justify-between w-full">
                                                                            <span>{{ selectedCart.carts[i + pagination.startIndex].deliveryProviderName }}</span>
                                                                            <img
                                                                                matSuffix
                                                                                class="w-1/3 max-h-10"
                                                                                *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryProviderImg"
                                                                                [alt]="'Delivery provider image'"
                                                                                [src]="selectedCart.carts[i + pagination.startIndex].deliveryProviderImg">
                                                                        </span>
                                                                    </mat-select-trigger>
                                                                    <ng-container *ngFor="let deliveryProvider of selectedCart.carts[i + pagination.startIndex].deliveryQuotations">
                                                                        <mat-option 
                                                                            [value]="deliveryProvider.providerId">
                                                                            <div class="flex flex-row justify-between items-center">
                                                                                <span class="w-2/3">{{deliveryProvider.providerName}}</span>
                                                                                <img
                                                                                    matSuffix
                                                                                    class="w-auto max-h-8 p-1"
                                                                                    *ngIf="deliveryProvider.providerImage"
                                                                                    [alt]="'Delivery provider image'"
                                                                                    [src]="deliveryProvider.providerImage">
                                                                            </div>
                                                                        </mat-option>
                                                                    </ng-container>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                        <div *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryType === 'SELF'" 
                                                            class="flex flex-row w-full items-center">
                                                            <mat-label class="flex w-full px-4 items-center h-10 rounded-md border border-gray-300 text-sm">
                                                                Self Delivery</mat-label>
                                                        </div>
                                                    </div>
                                                    <div class="flex flex-col sm:flex-row sm:min-w-44 gap-x-1">
                                                        <span class="text-sm">Shipping Fee:</span>
                                                        <!-- <span class="font-semibold text-xs sm:text-sm tracking-tight">{{ getDeliveryChargesRange(i + pagination.startIndex) }}</span> -->
                                                        <ng-container *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.selectedDeliveryPrice">
                                                            <div class="flex flex-col">
                                                                <div class="flex flex-row gap-1">
                                                                    <!-- Ori Price  -->
                                                                    <span 
                                                                        [ngClass]="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount !== 0 && selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount ? 
                                                                            'line-through font-normal' : 'font-semibold'"
                                                                        class="text-sm tracking-tight">{{selectedCart.carts[i + pagination.startIndex].deliveryPrice.selectedDeliveryPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                                    <!-- Discounted price  -->
                                                                    <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount !== 0 && selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount"
                                                                        class="font-semibold text-sm tracking-tight">{{selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountedPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                                </div>
                                                                <!-- Off  -->
                                                                <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount !== 0 && selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount" 
                                                                    class="-mt-[0.15rem] text-xs tracking-tight">(save {{selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount | currency: cart.store.regionCountry.currencySymbol}})</span>
                                                            </div>
                                                        </ng-container>
                                                    </div>
                                                </ng-container>
                                                <ng-template #deliveryErrorDesktop>
                                                    <div>
                                                        <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage" class="font-semibold text-sm" >{{ selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage }}</span>
                                                        <ng-container *ngIf="!selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage && !validateCustomerInfo(i + pagination.startIndex)">
                                                            <div class="text-sm">
                                                                <span 
                                                                    class="underline cursor-pointer text-primary" 
                                                                    [routerLink]="'/address'"
                                                                    [queryParams]="{origin: 'carts'}">
                                                                    Add delivery address
                                                                </span>
                                                            </div>
                                                        </ng-container>
                                                    </div>
                                                </ng-template>
                                            </div>
                                            <!-- Total Items  -->
                                            <div class="flex flex-col sm:flex-row items-center sm:min-w-auto gap-1 sm:gap-x-1">
                                                <span class="text-sm">Total Items ({{cart.cartItems ? cart.cartItems.length : 0}}):</span>
                                                <span class="font-semibold text-sm">{{ getCartItemsTotal(cart.cartItems) | currency: cart.store.regionCountry.currencySymbol }}</span>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <!-- Select Delivery Provider for MOBILE-->
                                    <div *ngIf="!currentScreenSize.includes('lg') && selectedCart.carts[i + pagination.startIndex].isSelfPickup === false" class="mt-2 flex flex-col gap-y-2">
                                        <ng-container *ngIf="!selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage && selectedCart.carts[i + pagination.startIndex].deliveryQuotationId">
                                            <div class="flex flex-row justify-between items-center w-full">
                                                <div *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryType !== 'SELF'" class="flex flex-row w-full">
                                                    <mat-form-field class="w-full rounded text-sm fuse-mat-no-subscript fuse-mat-dense">
                                                        <mat-select
                                                            placeholder="Select a delivery provider"
                                                            (click)="openProviderSelection()"
                                                            (selectionChange)="changeDeliveryProvider(deliveryProviderSelector.value, i + pagination.startIndex)"
                                                            [(ngModel)]="selectedCart.carts[i + pagination.startIndex].deliveryProviderId"
                                                            [ngModelOptions]="{standalone: true}"
                                                            #deliveryProviderSelector="matSelect"
                                                            >
                                                            <mat-select-trigger>
                                                                <span class="flex items-center justify-between w-full">
                                                                    <span>{{ selectedCart.carts[i + pagination.startIndex].deliveryProviderName }}</span>
                                                                    <img
                                                                        matSuffix
                                                                        class="w-1/3 max-h-10"
                                                                        *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryProviderImg"
                                                                        [alt]="'Delivery provider image'"
                                                                        [src]="selectedCart.carts[i + pagination.startIndex].deliveryProviderImg">
                                                                </span>
                                                            </mat-select-trigger>
                                                            <ng-container *ngFor="let deliveryProvider of selectedCart.carts[i + pagination.startIndex].deliveryQuotations">
                                                                <mat-option 
                                                                    [value]="deliveryProvider.providerId">
                                                                    <div class="flex flex-row justify-between items-center">
                                                                        <span class="w-2/3">{{deliveryProvider.providerName}}</span>
                                                                        <img
                                                                            matSuffix
                                                                            class="w-auto max-h-8 p-1"
                                                                            *ngIf="deliveryProvider.providerImage"
                                                                            [alt]="'Delivery provider image'"
                                                                            [src]="deliveryProvider.providerImage">
                                                                    </div>
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                                <div *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryType === 'SELF'" class="flex flex-row w-full">
                                                    <mat-label class="flex w-full px-4 items-center h-10 rounded-md border border-gray-300 text-sm">
                                                        Self Delivery</mat-label>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <div class="flex flex-row justify-between items-center">
                                            <div class="flex flex-col sm:min-w-44">
                                                <ng-container *ngIf="!selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage && selectedCart.carts[i + pagination.startIndex].deliveryQuotationId; else deliveryErrorMobile">
                                                    <span class="text-sm">Shipping Fee:</span>
                                                    <!-- <span class="font-semibold text-sm tracking-tight">{{ getDeliveryChargesRange(i + pagination.startIndex) }}</span> -->
                                                    <ng-container *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.selectedDeliveryPrice">
                                                        <div class="flex flex-col">
                                                            <div class="flex flex-row gap-1">
                                                                <!-- Ori Price  -->
                                                                <span 
                                                                    [ngClass]="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount !== 0 && selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount ? 
                                                                        'line-through font-normal' : 'font-semibold'"
                                                                    class="text-sm tracking-tight">{{selectedCart.carts[i + pagination.startIndex].deliveryPrice.selectedDeliveryPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                                <!-- Discounted price  -->
                                                                <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount !== 0 && selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount"
                                                                    class="font-semibold text-sm tracking-tight">{{selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountedPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                            </div>
                                                            <!-- Off  -->
                                                            <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount !== 0 && selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount" 
                                                                class="-mt-[0.15rem] text-xs tracking-tight">(save {{selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount | currency: cart.store.regionCountry.currencySymbol}})</span>
                                                        </div>
                                                    </ng-container>
                                                    <!-- <div class="flex flex-row gap-1">
                                                        <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount === null"
                                                            class="font-semibold text-sm tracking-tight">{{ selectedCart.carts[i + pagination.startIndex].deliveryPrice.selectedDeliveryPrice | currency: cart.store.regionCountry.currencySymbol }}</span>
                                                        <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount !== 0 && selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountAmount" 
                                                            class="text-sm line-through tracking-tight">{{selectedCart.carts[i + pagination.startIndex].deliveryPrice.selectedDeliveryPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                        <span class="font-semibold text-sm tracking-tight">{{selectedCart.carts[i + pagination.startIndex].deliveryPrice.discountedPrice | currency: cart.store.regionCountry.currencySymbol}}</span>
                                                    </div> -->
                                                </ng-container>
                                                <ng-template #deliveryErrorMobile>
                                                    <div>
                                                        <span *ngIf="selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage" class="font-semibold text-sm" >{{ selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage }}</span>
                                                        <ng-container *ngIf="!selectedCart.carts[i + pagination.startIndex].deliveryErrorMessage && !validateCustomerInfo(i + pagination.startIndex)">
                                                            <div class="text-sm">
                                                                <span 
                                                                    class="underline cursor-pointer text-primary" 
                                                                    [routerLink]="'/address'"
                                                                    [queryParams]="{origin: 'carts'}">
                                                                    Add delivery address
                                                                </span>
                                                            </div>
                                                        </ng-container>
                                                    </div>
                                                </ng-template>
                                            </div>
                                            <div class="flex flex-col">
                                                <span class="text-sm mr-1">Total Items ({{cart.cartItems ? cart.cartItems.length : 0}}):</span>
                                                <span class="font-semibold text-sm">{{ getCartItemsTotal(cart.cartItems) | currency: cart.store.regionCountry.currencySymbol }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Store Address for self pickup  -->
                                    <ng-container *ngIf="selectedCart.carts[i + pagination.startIndex].isSelfPickup">
                                        <div class="flex flex-col gap-1 w-full mt-1">
                                            <div class="rounded border w-full flex flex-col p-3 gap-1 bg-primary-100">
                                                <div class="flex flex-row items-center gap-2">
                                                    <mat-icon 
                                                        class="icon-size-5 text-primary" 
                                                        [svgIcon]="'mat_solid:storefront'"></mat-icon>
                                                    <span class="font-medium text-base">Store Address</span>
                                                </div>
                                                <div class="flex flex-row font-base gap-1 items-center justify-between w-full">
                                                    <!-- Address  -->
                                                    <div class="flex flex-col text-sm gap-1">
                                                        <span class="">{{cart.store.name}}</span>
                                                        <span class="">{{cart.store.phoneNumber}}</span>
                                                        <span class="">{{cart.store.address}}, {{cart.store.postcode}}, {{cart.store.city}}, {{cart.store.regionCountryStateId}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </ng-container>
                                <ng-template #noCartItem>
                                    <!-- Main -->
                                    <div class="relative flex justify-center items-center w-full h-full md:h-96">
                                        <error-background class="absolute z-0 inset-0 w-full opacity-50"></error-background>
                                        <div class="flex flex-col w-full h-full items-center justify-center z-10">
                                            <span class="mt-2 text-4xl md:text-5xl font-semibold tracking-tight leading-tight md:leading-none text-center">Cart is empty!</span>
                                            <span class="mt-4 max-w-120 text-lg md:text-xl font-medium tracking-tight text-center text-secondary">Shop now at {{cart.store.name}}</span>
                                        </div>
                                    </div>
                                </ng-template>
                            </div>
                        </div>
                    </ng-container>
                </div>
                <!-- Pagination -->
                <pagination 
                    *ngIf="pagination.length > pagination.size"
                    class="mt-4"
                    [itemLength]="pagination.length" 
                    [initialPage]="pagination.page + 1"
                    [pageSize]="pagination.size"
                    (click)="scrollToTop()"
                    (changePage)="onChangePage($event)"></pagination>
            </div>

            <!-- Cart Summary -->
            <div *ngIf="platform" class="flex flex-col w-full md:w-140 md:ml-6 md:mt-8 mt-4">
                <!-- Cart Summary -->
                <div class="flex flex-col border rounded-lg p-2">
                    <!-- Header -->
                    <div class="flex flex-row border-b justify-start items-center pb-2 w-full">
                        <mat-icon 
                            class="icon-size-5 text-primary" 
                            [svgIcon]="'mat_solid:add_shopping_cart'"></mat-icon>
                        <span class="ml-2 font-bold">Cart Summary</span>
                    </div>
                    <!-- Summary -->
                    <!-- Sub Total -->
                    <div class="flex flex-row justify-between mt-2">
                        <span class="text-md text-secondary">Sub Total <small *ngIf="totalSelectedCartItem === 1">({{totalSelectedCartItem}} item)</small><small *ngIf="totalSelectedCartItem > 1">({{totalSelectedCartItem}} items)</small></span>
                        <span class="text-md font-semibold">{{paymentDetails.cartSubTotal | currency: platform.currency}}</span>
                    </div>
                    <!-- Order Discount -->
                    <ng-container *ngIf="paymentDetails.subTotalDiscount !== 0">
                        <div class="flex flex-row w-full justify-between  mt-2">
                            <div class="flex flex-col">
                                <div class="text-md text-secondary">
                                    <span>Order Discount</span>
                                    <span *ngIf="paymentDetails.subTotalDiscountDescription">&nbsp;({{paymentDetails.subTotalDiscountDescription}})</span>
                                </div>
                                <span class="text-xs text-gray-500" *ngIf="paymentDetails.discountMaxAmount && paymentDetails.discountMaxAmount != 0 && paymentDetails.subTotalDiscount >= paymentDetails.discountMaxAmount && paymentDetails.subTotalDiscount != 0">
                                    Capped at {{paymentDetails.discountMaxAmount | currency: platform.currency }}
                                </span>
                            </div>
                            <span class="font-semibold">-{{paymentDetails.subTotalDiscount | currency: platform.currency}}</span>
                        </div>
                    </ng-container>
                    <!-- Service Charges -->
                    <ng-container *ngIf="paymentDetails.storeServiceCharge !== 0">
                        <div class="flex flex-row justify-between mt-2">
                            <span class="text-md text-secondary">Service Charge</span> 
                            <span class="text-md font-semibold">{{paymentDetails.storeServiceCharge | currency: platform.currency}}</span>
                        </div>
                    </ng-container>
                    <!-- Delivery Fee -->
                    <div class="flex flex-row justify-between mt-2">
                        <span class="text-md text-secondary">Shipping Fee</span>
                        <span class="text-md font-semibold">{{paymentDetails.deliveryCharges | currency: platform.currency}}</span>
                    </div>
                    <!-- Delivery Discount -->
                    <!-- <ng-container *ngIf="paymentDetails.deliveryDiscount !== 0">
                        <div class="flex flex-row w-full justify-between py-1">
                            <div class="flex flex-col">
                                <div class="text-md text-secondary mt-2">
                                    <span>Delivery Discount</span>
                                    <span *ngIf="paymentDetails.deliveryDiscountDescription">&nbsp;({{paymentDetails.deliveryDiscountDescription}})</span>
                                </div>
                                <span class="text-xs text-gray-500" *ngIf="paymentDetails.deliveryDiscountMaxAmount != 0 && paymentDetails.deliveryDiscount >= paymentDetails.deliveryDiscountMaxAmount && paymentDetails.deliveryDiscount != 0">
                                    Capped at {{paymentDetails.deliveryDiscountMaxAmount | currency: platform.currency }}
                                </span>
                            </div>
                            <span class="font-semibold">-{{paymentDetails.deliveryDiscount | currency: platform.currency}}</span>
                        </div>
                    </ng-container> -->

                    <ng-container *ngIf="paymentDetails.deliveryDiscount !== 0">
                        <div class="flex flex-row justify-between mt-2">
                            <span class="text-md text-secondary">Shipping Fee Discount</span>
                            <span class="text-md font-semibold">-{{paymentDetails.deliveryDiscount | currency: platform.currency}}</span>
                        </div>
                    </ng-container>

                    <div *ngIf="paymentDetails.platformVoucherDeliveryDiscount && paymentDetails.platformVoucherDeliveryDiscount !== 0" class="flex flex-row justify-between mt-2">
                        <span class="text-md text-secondary">Deliverin Shipping Discount</span>
                        <span class="text-md font-semibold">-{{paymentDetails.platformVoucherDeliveryDiscount | currency: platform.currency}}</span>
                    </div>
                    
                    <div *ngIf="paymentDetails.platformVoucherSubTotalDiscount && paymentDetails.platformVoucherSubTotalDiscount !== 0" class="flex flex-row justify-between mt-2">
                        <span class="text-md text-secondary">Deliverin Promo Code/Voucher</span>
                        <span class="text-md font-semibold">-{{paymentDetails.platformVoucherSubTotalDiscount | currency: platform.currency}}</span>
                    </div>

                    <!-- Separator -->
                    <div class="border-b w-full my-1"></div>

                    <ng-container *ngIf="customerId; else guestVoucher">
                        <!-- Voucher Dropdown -->
                        <ng-container *ngIf="customerVouchers && customerVouchers.length > 0">
                            <mat-form-field class="fuse-mat-no-subscript fuse-mat-dense w-full my-1 text-sm" floatLabel="always">
                                <mat-select 
                                    placeholder="Select My Voucher"
                                    (selectionChange)="selectVoucher(voucherSelector.value);"
                                    [(ngModel)]="voucherApplied"
                                    [ngModelOptions]="{standalone: true}"
                                    #voucherSelector="matSelect">
                                    <mat-select-trigger>
                                        <span class="flex items-center">
                                            <span>{{ voucherSelector.triggerValue }}</span>
                                        </span>
                                    </mat-select-trigger>
                                    <div *ngFor="let voucher of customerVouchers">
                                        <ng-container *ngIf="(voucher.voucher.voucherType === 'PLATFORM' ) && validateVoucher(voucher)">
                                            <mat-option [value]="voucher">{{voucher.voucher.name}}</mat-option>
                                        </ng-container>
                                    </div>
                                </mat-select>
                                <button
                                    mat-icon-button
                                    type="button"
                                    *ngIf="voucherApplied"
                                    (click)="deselectVoucher(); $event.stopPropagation()"
                                    matSuffix>
                                    <mat-icon
                                        class="text-gray-500 icon-size-4 ml-2"
                                        [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                </button>                                              
                            </mat-form-field>
                        </ng-container>
    
                        <!-- Voucher Input -->
                        <ng-container *ngIf="displayRedeem; else displayHavePromo">
                            <mat-form-field class="w-full mt-1 fuse-mat-no-subscript fuse-mat-dense text-sm" floatLabel="always">
                                <input
                                    matInput
                                    placeholder="Enter Promo Code"
                                    autocomplete="disabled"
                                    [(ngModel)]="promoCode"
                                    [ngModelOptions]="{standalone: true}"
                                    >
                                    <button class="bg-primary py-2 px-4 rounded text-white"
                                    [disabled]="isLoading" 
                                    [ngClass]="isLoading ? 'cursor-wait bg-gray-200' : 'bg-primary-500 hover:bg-primary-600'"
                                    (click)="claimPromoCode(); $event.preventDefault()">
                                        Apply
                                    </button>
                            </mat-form-field>
                        </ng-container>

                        <ng-template #displayHavePromo>
                            <div class="text-xs mt-1">
                                <span>Having a Promo Code? Redeem </span>
                                <span class="underline cursor-pointer text-primary" 
                                    (click)="displayRedeem = true">
                                here
                                </span>
                            </div>
                        </ng-template>

                    </ng-container>

                    <ng-template #guestVoucher>
                        <!-- Voucher Dropdown -->
                        <ng-container *ngIf="guestVouchers">
                            <mat-form-field class="fuse-mat-no-subscript fuse-mat-dense w-full mt-1 text-sm" floatLabel="always">
                                <input
                                matInput
                                readonly
                                [(ngModel)]="guestVouchers.voucher.name"
                                [ngModelOptions]="{standalone: true}"
                                >
                                <button
                                    mat-icon-button
                                    type="button"
                                    *ngIf="voucherApplied"
                                    (click)="deselectVoucher(); $event.stopPropagation()"
                                    matSuffix>
                                    <mat-icon
                                        class="text-gray-500 icon-size-4 ml-2"
                                        [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                </button>                                              
                            </mat-form-field>
                        </ng-container>
    
                        <!-- Voucher Input -->
                        <ng-container *ngIf="guestVouchers === null">
                            <ng-container *ngIf="true; else displayHavePromo">
                                <mat-form-field class="w-full mt-1 fuse-mat-no-subscript fuse-mat-dense text-sm" floatLabel="always">
                                    <input
                                        matInput
                                        placeholder="Enter Promo Code"
                                        autocomplete="disabled"
                                        [(ngModel)]="promoCode"
                                        [ngModelOptions]="{standalone: true}"
                                        >
                                        <button class="bg-primary py-2 px-4 rounded text-white"
                                        [disabled]="isLoading" 
                                        [ngClass]="isLoading ? 'cursor-wait bg-gray-200' : 'bg-primary-500 hover:bg-primary-600'"
                                        (click)="claimPromoCode(); $event.preventDefault()">
                                            Apply
                                        </button>
                                </mat-form-field>
                            </ng-container>
    
                            <ng-template #displayHavePromo>
                                <div class="text-xs mt-1">
                                    <span>Having a Promo Code? Redeem </span>
                                    <span class="underline cursor-pointer text-primary" 
                                        (click)="displayRedeem = true">
                                    here
                                    </span>
                                </div>
                            </ng-template>
                        </ng-container>
    
                    </ng-template>


                    <!-- Separator -->
                    <div class="border-b w-full my-2"></div>

                    <!-- Grand Total -->
                    <div class="flex flex-row justify-between mt-2">
                        <span class="text-md text-secondary">Grand Total</span>
                        <span class="text-md font-semibold">{{paymentDetails.cartGrandTotal | currency: platform.currency}}</span>
                    </div>

                    <!-- Checkout -->
                    <button 
                        (click)="goToCheckout()"
                        [disabled]="isLoading"
                        class="py-2 px-4 rounded w-full mt-2 text-white"
                        [ngClass]="{ 'cursor-wait bg-gray-400' : isLoading, 
                                     'cursor-pointer bg-primary hover:bg-primary-600' : !isLoading || !isPristine,
                                     'cursor-not-allowed bg-gray-400' : isPristine}">
                        Checkout Now
                    </button>
                </div>
                <!-- Delivery Address (md) -->
                <div class="hidden md:block flex flex-col justify-center items-center border rounded-lg p-2 mt-4">
                    <!-- Header -->
                    <div class="flex flex-row border-b justify-start items-center pb-2 w-full">
                        <mat-icon 
                            class="icon-size-5 text-primary" 
                            [svgIcon]="'mat_solid:location_on'"></mat-icon>
                        <span class="ml-2 font-bold">Delivery Address</span>
                    </div>
                    <ng-container *ngIf="customerAddress; else noAddress">
                        <!-- <ng-container *ngFor="let address of customerAddresses"> -->
                            <!-- <ng-container *ngIf="customerAddress.isDefault"> -->
                                <div class="flex flex-row p-2 font-medium gap-1 items-center justify-between w-full">
                                    <!-- Address  -->
                                    <div class="flex flex-col font-medium gap-1">
                                        <span class="">{{customerAddress.name}}</span>
                                        <span class="">{{customerAddress.phoneNumber}}</span>
                                        <span class="">{{customerAddress.address}}, {{customerAddress.postCode}}, {{customerAddress.city}}, {{customerAddress.state}}</span>
                                    </div>
                                    <!-- Remove Address -->
                                    <div *ngIf="!customerId">
                                        <span class="hidden sm:flex justify-center items-center text-center px-1 cursor-pointer">
                                            <mat-icon 
                                                (click)="deleteGuestAddress()"
                                                class="icon-size-4" 
                                                [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                        </span>
                                    </div>
                                </div>
                                <div class="flex w-full justify-center items-center">
                                    <button
                                        [routerLink]="'/address'"
                                        [queryParams]="{origin: 'carts'}"
                                        class="my-2 w-1/2 font-semibold p-1 rounded-md bg-primary"                            >
                                        <span class="text-white">Change</span>
                                    </button>
                                </div>
                            <!-- </ng-container> -->
                        <!-- </ng-container> -->
                    </ng-container>
                    <ng-template #noAddress>
                        <!-- Enter Address -->
                        <span class="flex mt-2 text-center">Add your delivery address</span>
                        <!-- Button -->
                        <div class="flex w-full justify-center items-center mt-2">
                            <button 
                                [routerLink]="'/address'"
                                [queryParams]="{origin: 'carts'}"
                                class="my-2 w-1/2 bg-primary-500 hover:bg-primary-600 rounded-md flex flex-row items-center justify-center p-1"
                            >
                                <mat-icon 
                                    class="icon-size-5 text-white" 
                                    [svgIcon]="'heroicons_solid:plus'"></mat-icon>
                                <span class="ml-1 font-semibold text-white">Add</span>
                            </button>
                        </div>
                    </ng-template>
                </div>
                <!-- Store pickup info (md)  -->
                <ng-container *ngIf="hasSelfPickup">
                    <div class="hidden md:block flex flex-col justify-center items-center border rounded-lg p-2 mt-4">
                        <!-- Header -->
                        <div class="flex flex-row border-b justify-start items-center pb-2 w-full">
                            <mat-icon 
                                class="icon-size-5 text-primary" 
                                [svgIcon]="'mat_solid:contact_phone'"></mat-icon>
                            <span class="ml-2 font-bold">Contact Info for Self Pick-up</span>
                        </div>
                        <ng-container *ngIf="selfPickupInfo; else noSelfPickupInfo">
                            <div class="w-full flex flex-col rounded">
                                <div class="flex flex-row p-2 font-medium gap-1 items-center justify-between w-full">
                                    <!-- Address  -->
                                    <div class="flex flex-col font-medium gap-1">
                                        <span class="">{{selfPickupInfo.name}}</span>
                                        <span class="">{{selfPickupInfo.phoneNumber}}</span>
                                        <span class="">{{selfPickupInfo.email}}</span>
                                    </div>
                                </div>
                                <!-- Button -->
                                <div class="flex w-full justify-center items-center">
                                    <button 
                                        (click)="addRequiredInfo(0, true)"
                                        class="my-2 w-1/2 bg-primary-500 hover:bg-primary-600 rounded-md flex flex-row items-center justify-center p-1"
                                    >
                                        <mat-icon 
                                            class="icon-size-4 text-white" 
                                            [svgIcon]="'heroicons_solid:pencil'"></mat-icon>
                                        <span class="ml-1 font-semibold text-white">Edit</span>
                                    </button>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #noSelfPickupInfo>
                            <!-- Enter contact info -->
                            <span class="flex mt-2 text-center">Add your contact info</span>
                            <!-- Button -->
                            <div class="flex w-full justify-center items-center mt-2">
                                <button 
                                (click)="addRequiredInfo()"
                                    class="my-2 w-1/2 bg-primary-500 hover:bg-primary-600 rounded-md flex flex-row items-center justify-center p-1"
                                >
                                    <mat-icon 
                                        class="icon-size-5 text-white" 
                                        [svgIcon]="'heroicons_solid:plus'"></mat-icon>
                                    <span class="ml-1 font-semibold text-white">Add</span>
                                </button>
                            </div>
                        </ng-template>
                    </div>
                </ng-container>
                <!-- Store Address (md) -->
                <ng-container *ngIf="false">
                    <div class="flex flex-col justify-center items-center border rounded-lg p-2 mt-4">
                        <!-- Header -->
                        <div class="flex flex-row border-b justify-start items-center pb-2 w-full">
                            <mat-icon 
                                class="icon-size-5 text-primary" 
                                [svgIcon]="'mat_outline:storefront'"></mat-icon>
                            <span *ngIf="storesAddresses.length === 1" class="ml-2 font-bold">Store for Self Pick-up</span>
                            <span *ngIf="storesAddresses.length > 1" class="ml-2 font-bold">Stores for Self Pick-up</span>
                        </div>
                        <ng-container *ngFor="let storeAddress of storesAddresses">
                            <fuse-card class="rounded mt-2 w-full">
                                <div class="flex flex-row p-2 font-medium gap-1 items-center justify-between w-full">
                                    <!-- Address  -->
                                    <div class="flex flex-col font-medium gap-1 p-1">
                                        <span class="">{{storeAddress.storeName}}</span>
                                        <span class="">{{storeAddress.phoneNumber}}</span>
                                        <span class="">{{storeAddress.address}}, {{storeAddress.postCode}}, {{storeAddress.city}}, {{storeAddress.state}}</span>
                                    </div>
                                    <!-- Address  -->
                                    <!-- <div class="flex flex-col font-medium gap-1">
                                        <mat-icon 
                                            [matTooltip]="storeAddress.address + ', ' + storeAddress.postCode + ', ' + storeAddress.city + ', ' + storeAddress.state"
                                            class="icon-size-5 text-primary" 
                                            [svgIcon]="'mat_solid:location_on'"></mat-icon>
                                    </div> -->
                                </div>
                            </fuse-card>
                        </ng-container>
                    </div>
                </ng-container>
            </div>
        </ng-container>    

        <!-- No Carts -->
        <ng-template #noCarts>
            <!-- Main -->
            <div class="relative flex justify-center items-center w-full h-full md:h-96">
                <error-background class="absolute z-0 inset-0 w-full opacity-50"></error-background>
                <div class="flex flex-col w-full h-full items-center justify-center z-10">
                    <span class="mt-2 text-4xl md:text-5xl font-semibold tracking-tight leading-tight md:leading-none text-center">Cart is empty!</span>
                    <span class="mt-4 max-w-120 text-lg md:text-xl font-medium tracking-tight text-center text-secondary">Shop now at our stores</span>
                </div>
            </div>
        </ng-template>

    </div>
</div>